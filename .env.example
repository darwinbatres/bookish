# ============================================
# Shelf Book Reader - Environment Configuration
# ============================================
# Copy this file to .env.local for development
# or set these variables in your production environment
#
# ⚠️  NEVER commit actual secrets to version control!
# ⚠️  All values without defaults are REQUIRED
# ============================================

# --------------------------------------------
# Application Settings
# --------------------------------------------
NODE_ENV=development
PORT=3000

# --------------------------------------------
# Authentication (REQUIRED)
# --------------------------------------------
# Enable/disable authentication (default: true)
# Set to false only for local development without security
AUTH_ENABLED=true

# Login username (REQUIRED)
AUTH_USERNAME=admin

# Login password (REQUIRED - minimum 8 characters)
# Generate with: openssl rand -base64 12
AUTH_PASSWORD=

# Session secret for JWT signing (REQUIRED - minimum 32 characters)
# Generate with: openssl rand -base64 32
AUTH_SESSION_SECRET=

# Session duration in seconds (default: 7 days)
AUTH_SESSION_DURATION=604800

# --------------------------------------------
# PostgreSQL Database (ALL REQUIRED)
# --------------------------------------------
# Database host
# - Local development: localhost
# - Docker Compose: postgres (service name)
POSTGRES_HOST=localhost

# Database port (REQUIRED)
POSTGRES_PORT=5432

# Database name (REQUIRED)
POSTGRES_DB=shelf

# Database user (REQUIRED)
POSTGRES_USER=shelf

# Database password (REQUIRED - NEVER commit real values!)
# Generate with: openssl rand -base64 24
POSTGRES_PASSWORD=

# Maximum connections in pool (optional, default: 20)
POSTGRES_MAX_CONNECTIONS=20

# SSL mode for production (disable for local dev)
# Options: disable, require, verify-ca, verify-full
POSTGRES_SSL_MODE=disable

# --------------------------------------------
# S3/DigitalOcean Spaces Configuration (ALL REQUIRED)
# --------------------------------------------
# For DigitalOcean Spaces: https://<region>.digitaloceanspaces.com
# For AWS S3: https://s3.<region>.amazonaws.com
# For MinIO (local): http://localhost:9000

# Internal endpoint (REQUIRED - used by server/Docker network)
S3_ENDPOINT=http://localhost:9000

# Public endpoint for browser presigned URLs (optional, defaults to S3_ENDPOINT)
# For Docker: use host-accessible URL (e.g., http://localhost:9000 when using MinIO)
S3_PUBLIC_ENDPOINT=http://localhost:9000

# AWS Region (REQUIRED - e.g., us-east-1, nyc3 for DO Spaces)
S3_REGION=us-east-1

# Bucket name (REQUIRED)
S3_BUCKET=shelf-books

# Access credentials (REQUIRED - NEVER commit real values!)
S3_ACCESS_KEY_ID=
S3_SECRET_ACCESS_KEY=

# --------------------------------------------
# Upload Settings (Optional)
# --------------------------------------------
# NOTE: Max file size is now configured in Settings UI (stored in database)
# Default: 100 MB, configurable from 1 MB to 2 GB

# Allowed book file types (comma-separated MIME types)
UPLOAD_ALLOWED_TYPES=application/pdf,application/epub+zip

# Presigned URL expiry in seconds (default: 1 hour)
PRESIGNED_URL_EXPIRY=3600

# --------------------------------------------
# Cover Image Settings
# --------------------------------------------
# Cover images are uploaded to S3 at: covers/{bookId}/{timestamp}.{ext}
# Allowed formats: JPEG, PNG, WebP, GIF
# NOTE: Max cover size is now configurable in Settings UI (default: 5 MB, max: 50 MB)

# --------------------------------------------
# Logging (Optional)
# --------------------------------------------
# Log level: debug, info, warn, error (default: info)
LOG_LEVEL=info

# Log HTTP requests (default: true)
LOG_REQUESTS=true

# --------------------------------------------
# Rate Limiting (Optional)
# --------------------------------------------
# Enable rate limiting (default: false)
RATE_LIMIT_ENABLED=false

# Requests per minute (default: 100)
RATE_LIMIT_RPM=100

# --------------------------------------------
# MinIO (Local Development Only)
# --------------------------------------------
# Only used with: docker compose --profile local-storage up -d
# This profile adds a local S3-compatible storage server
#
# MinIO Console: http://localhost:9001
MINIO_ROOT_USER=minioadmin
MINIO_ROOT_PASSWORD=minioadmin

# --------------------------------------------
# Cloudflare Tunnel (Production Deployment)
# --------------------------------------------
# Only used with: docker compose --profile tunnel up -d
# This profile adds secure internet exposure without opening ports
#
# Setup:
#   1. Go to https://one.dash.cloudflare.com → Networks → Tunnels
#   2. Create a tunnel and copy the token (starts with "eyJ...")
#   3. Configure public hostname to point to: http://app:3000
#
# CLOUDFLARE_TUNNEL_TOKEN=eyJ...

# --------------------------------------------
# Docker Compose Profiles Summary
# --------------------------------------------
# No profile:        App + PostgreSQL (use with external S3)
# local-storage:     + MinIO (local S3 for development)
# tunnel:            + Cloudflare Tunnel (secure internet access)
#
# Examples:
#   docker compose up -d                                    # Basic
#   docker compose --profile local-storage up -d            # With MinIO
#   docker compose --profile tunnel up -d                   # With Tunnel
#   docker compose --profile local-storage --profile tunnel up -d  # Both
